---
- hosts:
    - lxd-master
  become: true
  gather_facts: true
  any_errors_fatal: true
  tasks:
    - name: Create a started container
      community.general.lxd_container:
        name: "{{ item }}"
        ignore_volatile_options: false
        state: started
        source:
          type: image
          mode: pull
          server:
          protocol: lxd
          alias: base
        devices:
          eth0:
            nictype: "bridged"
            parent: "br0"
            type: "nic"
        profiles: ["k3s"]
        wait_for_ipv4_addresses: true
      timeout: 600
      with_inventory_hostnames:
        - master
        - worker
